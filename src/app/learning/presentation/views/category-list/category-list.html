<div class="team-container">
  @if (teamMembers().length > 0) {
    <div class="add-member-button-container">
      <button mat-raised-button color="primary" (click)="openAddMemberModal()">
        <mat-icon>person_add</mat-icon>
        Añadir Miembro
      </button>
    </div>
  }
  
        @if (teamMembers().length === 0) {
          <app-empty-state
            animationPath="assets/animations/empty-box.json"
            title="¡Tu equipo está vacío!"
            message="Comienza construyendo tu equipo de trabajo añadiendo miembros.<br>Colabora y gestiona tareas de manera eficiente."
            ctaText="Añadir Primer Miembro"
            ctaIcon="person_add"
            [ctaAction]="openAddMemberModal.bind(this)">
          </app-empty-state>
        } @else {
          <div class="team-grid">
            @for (member of teamMembers(); track member.id) {
              <mat-card class="member-card">
               <mat-card-header>
                 <button 
                   class="drag-handle"
                   mat-icon-button
                   draggable="true"
                   (dragstart)="onDragStart($event, member.id)"
                   (dragend)="onDragEnd($event)">
                   <span class="drag-handle-line">−</span>
                 </button>
                 <div class="member-info">
                   <div class="member-avatar" 
                        [style.background-color]="getMemberColor(member.name)">
                     <span class="member-initials">{{ member.avatar }}</span>
                   </div>
                   <div class="member-details">
                     <div class="member-title-row">
                       <mat-card-title>{{ member.name }}</mat-card-title>
                       <div class="traffic-light" [ngClass]="getTrafficLightClass(getMemberStats(member.name).total)">
                         <div class="light-dot"></div>
                       </div>
                     </div>
                     <div class="member-role-row">
                       <mat-card-subtitle>{{ member.role }}</mat-card-subtitle>
                       @if (getMemberStats(member.name).total > 0) {
                         <div class="member-status-badge" [ngClass]="getMemberStatusClass(getMemberStats(member.name).completionRate)">
                           <mat-icon>{{ getMemberStatusIcon(getMemberStats(member.name).completionRate) }}</mat-icon>
                           <span>{{ getMemberStatusText(getMemberStats(member.name).completionRate) }}</span>
                         </div>
                       }
                     </div>
                   </div>
                 </div>
                 <div class="member-header-right">
                 </div>
               </mat-card-header>
        <mat-card-content>
          @if (getMemberStats(member.name).total > 0) {
            <div class="member-overview">
              <div class="recent-tasks-header">
                <span class="recent-tasks-label">Tareas</span>
              </div>
              <div class="recent-tasks-grid">
                @for (task of getRecentTasks(member.name, 10); track task.id) {
                  <div class="task-square" 
                       [ngClass]="'task-status-' + task.status"
                       (click)="openTaskDetailModal(member.name)"></div>
                }
              </div>
            </div>
          } @else {
            <div class="no-tasks">
              <div class="no-tasks-icon">
                <mat-icon>inbox</mat-icon>
              </div>
              <h3>Sin tareas asignadas</h3>
              <p>Este miembro aún no tiene tareas asignadas</p>
            </div>
          }
        </mat-card-content>
      </mat-card>
    }
          </div>
        }
  
  <!-- Delete Trash Button -->
  @if (teamMembers().length > 0) {
    <button 
      class="trash-button"
      [class.drag-over]="dragOverTrash"
      (dragover)="onTrashDragOver($event)"
      (dragleave)="onTrashDragLeave($event)"
      (drop)="onTrashDrop($event)"
      mat-raised-button
      color="warn">
      <mat-icon>delete</mat-icon>
    </button>
  }
</div>

