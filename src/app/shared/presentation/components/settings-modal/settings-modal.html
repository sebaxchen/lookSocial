<div class="modal-overlay" (click)="closeModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="modal-header">
      <h2 class="modal-title">Configuración</h2>
      <button class="close-btn" (click)="closeModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Content with Sidebar -->
    <div class="modal-content">
      <!-- Sidebar -->
      <div class="sidebar">
        @for (item of menuItems; track item.id) {
          <button 
            class="sidebar-item" 
            [class.active]="selectedMenu === item.id"
            (click)="selectedMenu = item.id">
            <mat-icon class="sidebar-icon">{{ item.icon }}</mat-icon>
            <span class="sidebar-label">{{ item.label }}</span>
          </button>
        }
      </div>

      <!-- Main Content -->
      <div class="main-content">
        @if (selectedMenu === 'profile') {
          <div class="content-section">
            <h3 class="section-title">Perfil</h3>
            <div class="settings-item">
              <label class="settings-label">Nombre completo</label>
              <input type="text" class="settings-input" [value]="getUserName()" readonly>
            </div>
            <div class="settings-item">
              <label class="settings-label">Email</label>
              <input type="email" class="settings-input" [value]="getUserEmail()" readonly>
            </div>
            <div class="settings-item">
              <label class="settings-label">Bio</label>
              <textarea class="settings-input textarea" rows="4" placeholder="Escribe algo sobre ti"></textarea>
            </div>
            <div class="toggle-item">
              <div class="toggle-info">
                <span class="toggle-label">Home</span>
                <span class="toggle-desc">Mostrar vista de inicio en el menú de navegación</span>
              </div>
              <div class="toggle-switch">
                <input 
                  type="checkbox" 
                  id="home-visibility"
                  [checked]="viewPreferencesService.homeVisibility()"
                  (change)="viewPreferencesService.setHomeVisibility($any($event.target).checked)">
                <label for="home-visibility" class="toggle"></label>
              </div>
            </div>
          </div>
        }

        @if (selectedMenu === 'account') {
          <div class="content-section">
            <h3 class="section-title">Cuenta</h3>
            <div class="settings-item">
              <label class="settings-label">Cambiar contraseña</label>
              <input type="password" class="settings-input" placeholder="Nueva contraseña">
            </div>
            <div class="settings-item">
              <label class="settings-label">Confirmar contraseña</label>
              <input type="password" class="settings-input" placeholder="Confirma tu contraseña">
            </div>
          </div>
        }

        @if (selectedMenu === 'notifications') {
          <div class="content-section">
            <h3 class="section-title">Notificaciones</h3>
            <div class="toggle-item">
              <div class="toggle-info">
                <span class="toggle-label">Notificaciones por email</span>
                <span class="toggle-desc">Recibe actualizaciones por correo</span>
              </div>
              <div class="toggle-switch">
                <input type="checkbox" id="email-notifications">
                <label for="email-notifications" class="toggle"></label>
              </div>
            </div>
            <div class="toggle-item">
              <div class="toggle-info">
                <span class="toggle-label">Notificaciones push</span>
                <span class="toggle-desc">Recibe notificaciones en tiempo real</span>
              </div>
              <div class="toggle-switch">
                <input type="checkbox" id="push-notifications" checked>
                <label for="push-notifications" class="toggle"></label>
              </div>
            </div>
          </div>
        }

        @if (selectedMenu === 'privacy') {
          <div class="content-section">
            <h3 class="section-title">Privacidad</h3>
            <div class="toggle-item">
              <div class="toggle-info">
                <span class="toggle-label">Perfil público</span>
                <span class="toggle-desc">Permite que otros vean tu perfil</span>
              </div>
              <div class="toggle-switch">
                <input type="checkbox" id="public-profile" checked>
                <label for="public-profile" class="toggle"></label>
              </div>
            </div>
            <div class="toggle-item">
              <div class="toggle-info">
                <span class="toggle-label">Búsqueda en línea</span>
                <span class="toggle-desc">Permite que aparezcas en búsquedas</span>
              </div>
              <div class="toggle-switch">
                <input type="checkbox" id="searchable" checked>
                <label for="searchable" class="toggle"></label>
              </div>
            </div>
          </div>
        }

        @if (selectedMenu === 'preferences') {
          <div class="content-section">
            <h3 class="section-title">Preferencias</h3>
            <div class="settings-item">
              <label class="settings-label">Idioma</label>
              <select class="settings-input select">
                <option>Español</option>
                <option>English</option>
                <option>Français</option>
              </select>
            </div>
            <div class="settings-item">
              <label class="settings-label">Zona horaria</label>
              <select class="settings-input select">
                <option>UTC-5</option>
                <option>UTC+0</option>
                <option>UTC+1</option>
              </select>
            </div>
          </div>
        }

        @if (selectedMenu === 'plans') {
          <div class="content-section">
            <h3 class="section-title">Planes</h3>
            <div class="plans-grid">
              @for (plan of plans; track plan.id) {
                <div class="plan-card" [class.current]="currentPlan === plan.id" [class.recommended]="plan.id === 'basic'">
                  @if (plan.id === 'basic') {
                    <div class="popular-badge">Más Popular</div>
                  }
                  <div class="plan-header">
                    <h4 class="plan-name">{{ plan.name }}</h4>
                    <div class="plan-price">{{ plan.price }}</div>
                  </div>
                  <ul class="plan-features">
                    @for (feature of plan.features; track feature) {
                      <li class="plan-feature">
                        <mat-icon class="feature-icon">check_circle</mat-icon>
                        {{ feature }}
                      </li>
                    }
                  </ul>
                  <button class="plan-button" [class]="currentPlan === plan.id ? 'active' : (plan.id === 'premium' ? 'premium' : 'default')" (click)="selectPlan(plan)">
                    @if (currentPlan === plan.id) {
                      Plan Actual
                    } @else {
                      Seleccionar
                    }
                  </button>
                </div>
              }
            </div>
          </div>
          
          <!-- Benefits Section -->
          <div class="benefits-section">
            <h4 class="benefits-title">Beneficios de nuestros planes</h4>
            <div class="benefits-grid">
              <div class="benefit-item">
                <div class="benefit-icon">
                  <mat-icon>security</mat-icon>
                </div>
                <h5 class="benefit-name">Seguridad Avanzada</h5>
                <p class="benefit-description">Tus datos están protegidos con encriptación de última generación</p>
              </div>
              <div class="benefit-item">
                <div class="benefit-icon">
                  <mat-icon>cloud_sync</mat-icon>
                </div>
                <h5 class="benefit-name">Sincronización en Tiempo Real</h5>
                <p class="benefit-description">Trabaja desde cualquier dispositivo sin perder tu progreso</p>
              </div>
              <div class="benefit-item">
                <div class="benefit-icon">
                  <mat-icon>support_agent</mat-icon>
                </div>
                <h5 class="benefit-name">Soporte Prioritario</h5>
                <p class="benefit-description">Respuesta rápida a todas tus consultas y problemas</p>
              </div>
              <div class="benefit-item">
                <div class="benefit-icon">
                  <mat-icon>trending_up</mat-icon>
                </div>
                <h5 class="benefit-name">Analíticas Detalladas</h5>
                <p class="benefit-description">Mide tu productividad con reportes completos y insights</p>
              </div>
              <div class="benefit-item">
                <div class="benefit-icon">
                  <mat-icon>update</mat-icon>
                </div>
                <h5 class="benefit-name">Actualizaciones Constantes</h5>
                <p class="benefit-description">Acceso a nuevas características y mejoras regularmente</p>
              </div>
              <div class="benefit-item">
                <div class="benefit-icon">
                  <mat-icon>cancel</mat-icon>
                </div>
                <h5 class="benefit-name">Cancela Cuando Quieras</h5>
                <p class="benefit-description">Sin compromisos, cancela tu suscripción en cualquier momento</p>
              </div>
            </div>
          </div>
        }

        @if (selectedMenu === 'benefits') {
          <div class="content-section">
            <h3 class="section-title">Beneficios</h3>
            
            <!-- Benefits Overview -->
            <div class="benefits-intro">
              <p class="benefits-intro-text">
                Descubre todas las ventajas que obtienes al ser parte de nuestra plataforma
              </p>
            </div>

            <!-- Main Benefits Grid -->
            <div class="benefits-grid">
              <div class="benefit-item">
                <div class="benefit-icon">
                  <mat-icon>security</mat-icon>
                </div>
                <h5 class="benefit-name">Seguridad Avanzada</h5>
                <p class="benefit-description">Tus datos están protegidos con encriptación de última generación y protocolos de seguridad de nivel empresarial</p>
              </div>
              <div class="benefit-item">
                <div class="benefit-icon">
                  <mat-icon>cloud_sync</mat-icon>
                </div>
                <h5 class="benefit-name">Sincronización en Tiempo Real</h5>
                <p class="benefit-description">Trabaja desde cualquier dispositivo sin perder tu progreso. Todo se sincroniza instantáneamente</p>
              </div>
              <div class="benefit-item">
                <div class="benefit-icon">
                  <mat-icon>support_agent</mat-icon>
                </div>
                <h5 class="benefit-name">Soporte Prioritario</h5>
                <p class="benefit-description">Respuesta rápida a todas tus consultas y problemas con nuestro equipo de expertos</p>
              </div>
              <div class="benefit-item">
                <div class="benefit-icon">
                  <mat-icon>trending_up</mat-icon>
                </div>
                <h5 class="benefit-name">Analíticas Detalladas</h5>
                <p class="benefit-description">Mide tu productividad con reportes completos, gráficos y insights personalizados</p>
              </div>
              <div class="benefit-item">
                <div class="benefit-icon">
                  <mat-icon>update</mat-icon>
                </div>
                <h5 class="benefit-name">Actualizaciones Constantes</h5>
                <p class="benefit-description">Acceso temprano a nuevas características y mejoras que lanzamos regularmente</p>
              </div>
              <div class="benefit-item">
                <div class="benefit-icon">
                  <mat-icon>cancel</mat-icon>
                </div>
                <h5 class="benefit-name">Cancela Cuando Quieras</h5>
                <p class="benefit-description">Sin compromisos a largo plazo. Cancela tu suscripción en cualquier momento sin penalizaciones</p>
              </div>
              <div class="benefit-item">
                <div class="benefit-icon">
                  <mat-icon>people</mat-icon>
                </div>
                <h5 class="benefit-name">Colaboración Ilimitada</h5>
                <p class="benefit-description">Trabaja con tu equipo sin restricciones. Invita a todos los miembros que necesites</p>
              </div>
              <div class="benefit-item">
                <div class="benefit-icon">
                  <mat-icon>storage</mat-icon>
                </div>
                <h5 class="benefit-name">Almacenamiento Expandido</h5>
                <p class="benefit-description">Guarda todos tus proyectos y archivos sin preocuparte por el espacio disponible</p>
              </div>
              <div class="benefit-item">
                <div class="benefit-icon">
                  <mat-icon>speed</mat-icon>
                </div>
                <h5 class="benefit-name">Rendimiento Optimizado</h5>
                <p class="benefit-description">Experiencia ultrarrápida con arquitectura de servidores de alto rendimiento</p>
              </div>
            </div>

            <!-- Additional Benefits -->
            <div class="additional-benefits-section">
              <h4 class="additional-benefits-title">Beneficios Adicionales</h4>
              <div class="additional-benefits-list">
                <div class="additional-benefit-item">
                  <mat-icon class="check-benefit-icon">check_circle</mat-icon>
                  <span>Acceso a recursos y plantillas exclusivas</span>
                </div>
                <div class="additional-benefit-item">
                  <mat-icon class="check-benefit-icon">check_circle</mat-icon>
                  <span>Webinars y capacitaciones gratuitas</span>
                </div>
                <div class="additional-benefit-item">
                  <mat-icon class="check-benefit-icon">check_circle</mat-icon>
                  <span>Programa de referidos con recompensas</span>
                </div>
                <div class="additional-benefit-item">
                  <mat-icon class="check-benefit-icon">check_circle</mat-icon>
                  <span>Integraciones con herramientas populares</span>
                </div>
                <div class="additional-benefit-item">
                  <mat-icon class="check-benefit-icon">check_circle</mat-icon>
                  <span>API personalizada para desarrolladores</span>
                </div>
                <div class="additional-benefit-item">
                  <mat-icon class="check-benefit-icon">check_circle</mat-icon>
                  <span>Soporte técnico 24/7 en planes premium</span>
                </div>
              </div>
            </div>

            <!-- Companies Section -->
            <div class="companies-section">
              <h4 class="companies-title">Empresas que confían en nosotros</h4>
              <div class="companies-grid">
                <div class="company-item" style="background: #FFD700;" (click)="openPartnersModal('metro')">
                  <div class="company-logo metro">Metro</div>
                  <div class="company-sublogo">cencosud</div>
                </div>
                <div class="company-item" style="background: #E53935;" (click)="openPartnersModal('plazavea')">
                  <div class="company-logo plazavea">
                    <span class="plazavea-plaza">plaza</span>
                    <span class="plazavea-vea">vea</span>
                  </div>
                </div>
                <div class="company-item" style="background: #32CD32;" (click)="openPartnersModal('falabella')">
                  <div class="company-logo falabella">falabella</div>
                </div>
                <div class="company-item" style="background: #000000;" (click)="openPartnersModal('florafauna')">
                  <div class="company-logo florafauna">FLORA & FAUNA</div>
                </div>
              </div>
            </div>
          </div>
        }

        @if (selectedMenu === 'about') {
          <div class="content-section">
            <h3 class="section-title">Acerca de</h3>
            <div class="about-content">
              <p class="about-text">NoteTo v1.0.0</p>
              <p class="about-desc">Plataforma de gestión de tareas y proyectos</p>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- Footer -->
    <div class="modal-footer">
      <button class="footer-btn cancel" (click)="closeModal()">Cancelar</button>
      <button class="footer-btn save">Guardar Cambios</button>
    </div>
  </div>
</div>

<!-- Payment Modal -->
@if (isPaymentModalOpen) {
  <div class="payment-modal-overlay" (click)="closePaymentModal()">
    <div class="payment-modal-container" (click)="$event.stopPropagation()">
      <div class="payment-modal-header">
        <h2 class="payment-modal-title">Procesar Pago</h2>
        <button class="payment-close-btn" (click)="closePaymentModal()">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <div class="payment-modal-content">
        @if (selectedPlanForPayment) {
          <div class="payment-summary">
            <div class="payment-plan-info">
              <h3 class="payment-plan-name">{{ selectedPlanForPayment.name }}</h3>
              <div class="payment-plan-price">{{ selectedPlanForPayment.price }}</div>
            </div>
            
            <div class="payment-details">
              <h4 class="payment-details-title">Detalles del pago</h4>
              
              <div class="payment-form">
                <div class="payment-form-group">
                  <label class="payment-label">Nombre en la tarjeta</label>
                  <input type="text" class="payment-input" placeholder="Juan Pérez">
                </div>
                
                <div class="payment-form-group">
                  <label class="payment-label">Número de tarjeta</label>
                  <input type="text" class="payment-input" placeholder="1234 5678 9012 3456" maxlength="19">
                </div>
                
                <div class="payment-form-row">
                  <div class="payment-form-group">
                    <label class="payment-label">Fecha de expiración</label>
                    <input type="text" class="payment-input" placeholder="MM/AA" maxlength="5">
                  </div>
                  
                  <div class="payment-form-group">
                    <label class="payment-label">CVV</label>
                    <input type="text" class="payment-input" placeholder="123" maxlength="3">
                  </div>
                </div>
              </div>
              
              <div class="payment-total">
                <div class="payment-total-label">Total a pagar</div>
                <div class="payment-total-amount">{{ selectedPlanForPayment.price }}</div>
              </div>
            </div>
          </div>
        }
      </div>

      <div class="payment-modal-footer">
        <button class="payment-btn payment-btn-cancel" (click)="closePaymentModal()">
          <mat-icon>close</mat-icon>
          Cancelar
        </button>
        <button class="payment-btn payment-btn-confirm" (click)="processPayment()">
          <mat-icon>payment</mat-icon>
          Pagar Ahora
        </button>
      </div>
    </div>
  </div>
}

<!-- Partners Modal -->
@if (isPartnersModalOpen) {
  <div class="partners-modal-overlay" (click)="closePartnersModal()">
    <div class="partners-modal-container" (click)="$event.stopPropagation()">
      <div class="partners-modal-header">
        <div class="partners-modal-icon">
          <mat-icon>card_giftcard</mat-icon>
        </div>
        <h2 class="partners-modal-title">Socio Comercial</h2>
        <button class="partners-close-btn" (click)="closePartnersModal()">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <div class="partners-modal-content">
        <div class="partners-info">
          <p class="partners-message">
            Cupones de Descuento
          </p>
          <p class="partners-submessage">
            Descubre las mejores ofertas y descuentos exclusivos de nuestros socios comerciales.
          </p>
        </div>

        <div class="coupons-list">
          @for (coupon of getCompanyCoupons(); track coupon.code) {
            <div class="coupon-card">
              <div class="coupon-header">
                <div class="coupon-discount">
                  <span class="discount-amount">{{ coupon.discount }}</span>
                </div>
                <button class="coupon-copy-btn" (click)="copyCouponCode(coupon.code)">
                  <mat-icon>content_copy</mat-icon>
                </button>
              </div>
              <div class="coupon-body">
                <div class="coupon-code">
                  <span class="code-label">Código:</span>
                  <span class="code-value">{{ coupon.code }}</span>
                </div>
                <p class="coupon-description">{{ coupon.description }}</p>
              </div>
            </div>
          }
        </div>
      </div>

      <div class="partners-modal-footer">
        <button class="partners-btn partners-btn-primary" (click)="closePartnersModal()">
          Entendido
        </button>
      </div>
    </div>
  </div>
}

