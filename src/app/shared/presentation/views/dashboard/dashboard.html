<div class="dashboard-container">
  @if (totalTasks() === 0) {
    <div class="empty-dashboard-state">
      <mat-icon class="empty-icon">assignment</mat-icon>
      <h2 class="empty-title">No hay tareas aún</h2>
      <p class="empty-message">Añade una nota en <strong>Home</strong> para comenzar</p>
    </div>
  } @else {
  <!-- Dashboard Layout -->
  <div class="dashboard-layout">
    <!-- Columna Izquierda -->
    <div class="dashboard-column left-column">
      <!-- KPIs -->
      <div class="kpis-section">
        <div class="stat-card total-tasks">
          <mat-icon>assignment</mat-icon>
          <div class="stat-info">
            <div class="stat-title">Total</div>
            <div class="stat-number">{{ totalTasks() }}</div>
          </div>
        </div>
        <div class="stat-card completed-tasks">
          <mat-icon>check_circle</mat-icon>
          <div class="stat-info">
            <div class="stat-title">Completadas</div>
            <div class="stat-number">{{ completedTasks() }}</div>
          </div>
        </div>
        <div class="stat-card in-progress-tasks">
          <mat-icon>schedule</mat-icon>
          <div class="stat-info">
            <div class="stat-title">En Progreso</div>
            <div class="stat-number">{{ inProgressTasks() }}</div>
          </div>
        </div>
        <div class="stat-card not-started-tasks">
          <mat-icon>play_circle_outline</mat-icon>
          <div class="stat-info">
            <div class="stat-title">Sin Iniciar</div>
            <div class="stat-number">{{ notStartedTasks() }}</div>
          </div>
        </div>
      </div>

      <!-- Prioridades -->
      <mat-card class="priority-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>flag</mat-icon>
            Prioridades
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="priority-grid">
            <div class="priority-square high">
              <mat-icon>priority_high</mat-icon>
              <span class="priority-label">Alta</span>
              <span class="priority-count">{{ highPriorityTasks() }}</span>
            </div>
            <div class="priority-square medium">
              <mat-icon>remove</mat-icon>
              <span class="priority-label">Media</span>
              <span class="priority-count">{{ mediumPriorityTasks() }}</span>
            </div>
            <div class="priority-square low">
              <mat-icon>keyboard_arrow_down</mat-icon>
              <span class="priority-label">Baja</span>
              <span class="priority-count">{{ lowPriorityTasks() }}</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Columna Central -->
    <div class="dashboard-column center-column">
      <!-- Equipo -->
      <mat-card class="team-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>group</mat-icon>
            Equipo
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="team-stats">
            <div class="team-stat">
              <div class="team-number">{{ totalTeamMembers() }}</div>
              <div class="team-label">Miembros</div>
            </div>
            <div class="team-stat">
              <div class="team-number">{{ todayTasks() }}</div>
              <div class="team-label">Hoy</div>
            </div>
            <div class="team-stat">
              <div class="team-number">{{ thisWeekTasks() }}</div>
              <div class="team-label">Semana</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Productividad del Equipo -->
      <mat-card class="team-productivity-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>trending_up</mat-icon>
            Productividad
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="team-members-grid">
            <div 
              *ngFor="let member of teamProductivity()" 
              class="member-card"
              [class.top-performer]="member.completionRate >= 80"
              [class.good-performer]="member.completionRate >= 60 && member.completionRate < 80"
              [class.average-performer]="member.completionRate >= 40 && member.completionRate < 60"
              [class.needs-improvement]="member.completionRate < 40">
              
              <div class="member-header">
                <div class="member-avatar" [style.background-color]="getMemberColor(member.name)">{{ member.avatar }}</div>
                <div class="member-info">
                  <div class="member-name">{{ member.name }}</div>
                  <div class="member-completion">{{ member.completionRate }}%</div>
                </div>
              </div>
              
              <div class="member-stats">
                <div class="member-stat">
                  <mat-icon>check_circle</mat-icon>
                  <span>{{ member.completedTasks }}</span>
                </div>
                <div class="member-stat">
                  <mat-icon>schedule</mat-icon>
                  <span>{{ member.inProgress }}</span>
                </div>
                <div class="member-stat">
                  <mat-icon>play_circle_outline</mat-icon>
                  <span>{{ member.notStarted }}</span>
                </div>
              </div>
              
              <mat-progress-bar 
                mode="determinate" 
                [value]="member.completionRate"
                class="member-progress">
              </mat-progress-bar>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Columna Derecha -->
    <div class="dashboard-column right-column">
      <!-- Tareas Recientes -->
      <mat-card class="recent-tasks-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>history</mat-icon>
            Tareas Recientes
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="recent-tasks-list">
            <div 
              *ngFor="let task of recentTasks()" 
              class="recent-task-item">
              <div class="task-info">
                <div class="task-title">{{ task.title }}</div>
                <div class="task-meta">
                  <div class="priority-indicator" [class]="'priority-' + task.priority">
                    <mat-icon>{{ getPriorityIcon(task.priority) }}</mat-icon>
                  </div>
                  <mat-chip [class]="'status-' + task.status">
                    {{ getStatusText(task.status) }}
                  </mat-chip>
                </div>
              </div>
              <div class="task-assignee">
                <mat-icon>person</mat-icon>
                <span>{{ task.assignee || 'Sin asignar' }}</span>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
  }
</div>
